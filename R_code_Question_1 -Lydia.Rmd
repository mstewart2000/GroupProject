---
title: "Question 1 "
author: "Tianyi Zuo"
date: "2022/3/18"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE}
library(ggplot2)
library(ape)
library(vegan)
library(dplyr)
library(reshape2)
library(cowplot)
```

## Input the data
```{r}
MBData<-read.csv("./Data/BacteriaCommunityMatrix.csv")
SBData<-read.csv("./Data/BacteriaSampleData.csv")
NBData<-read.csv("./Data/BacteriaTaxInfo.csv")
GData<-read.csv("./Data/GreenhouseData.csv")
```


## Question 1
Does the plant will affect the bacterial community composition in the soil source?


## Question 1-1
Does the plant species will affect the bacterial community composition?

In order to test the similarity between the bacterial community in different plant species area, we will use a Non-Metric Multidimensional Scaling (NMDS) to visualize differences among our samples. For this question, we mainly used the Bacteria Community Matrix to compared the composition of bacterial community among different plant species. The matrix data collected soil microbial communities associated with individuals of the four dominant plants species, which is community matrix of bacterial OTU characterized from each soil sample.


### Transforme the Data
According the data we have, I transform column and row first, and remove error which sum of row and column is zero. 
```{r}
rownames(MBData) <-MBData[,1] 
MBData<- MBData[,-1 ]
Matrix<-t(MBData)
Matrix <- Matrix[!(rowSums(Matrix) == 0), !(colSums(Matrix) == 0)]
```

### Distance Matrix
```{r warning=FALSE}
#Create the Bray_Curtis Dissimilarity metric
Dist<- vegdist(Matrix,method="bray",binary=F)
DistMat<-as.matrix(Dist)
PDat<-melt(DistMat)
```

### Non-Metric Multidimensional Scaling
Using Non-matric Dimensional Scaling(NMDS) to visualize the cluster of samplings from different plant species. We can find out whether in different plant species area has a stronger effect on bacterial communities.
```{r warning=FALSE}
set.seed(12138)
NMDSdat<-metaMDS(Dist,k=2  ,trymax = 200)
PDat<-data.frame(NMDS1=NMDSdat$points[,1],
                 NMDS2=NMDSdat$points[,2],
                 X=row.names(Matrix))
PDat<-merge(PDat,SBData,by="X",all.x=T,all.y=F)
qplot(x=NMDS1,y=NMDS2,colour=Species,alpha=I(0.6),data=PDat)+theme_bw()
```

Figure 1. NMDS plot show the overall variation in bacterial community composition among the different specific plant species. Points are color-coded based on the identity of the plant species: Ammophila (red); Baccharis(gree); Iceplant (orange); Lupine (blue); sand (pink).

According to the figure 1, the bacterial community composition differed between plant species, but the results were not significant. Based on the graph, the control group(sand) has less similarity with other four plant species.  Sampling from same plant specie's area are more likely cluster together, but there still have some overlap between different plant species. From figure 1, the bacterial community composition differed between plant species.


### Question 1-2
Does the plant growth age will affect the bacterial community composition?

We next wanted to investigate in more detail whether there is a temporal pattern in bacterial communities based on our available data and whether the composition of their communities changes depending on the time of plant growth.

### Transform Matrix
In order to test whether plant age will effect the bacterial community, we separate the bacterial community matrix into four different matrix depended on plant species. 
```{r}
MatrixA <- Matrix[grep("Ammophila", row.names(Matrix)), ]
MatrixB <- Matrix[grep("Baccharis", row.names(Matrix)), ]
MatrixI <- Matrix[grep("Iceplant", row.names(Matrix)), ]
MatrixL <- Matrix[grep("Lupine", row.names(Matrix)), ]
```

### Distance Matrix
```{r warning=FALSE}
#Create the Bray_Curtis Dissimilarity metric for each plant species
DistA<- vegdist(MatrixA,method="bray",binary=F)
DistMatA<-as.matrix(DistA)
PDatA<-melt(DistMatA)

DistB<- vegdist(MatrixB,method="bray",binary=F)
DistMatB<-as.matrix(DistB)
PDatB<-melt(DistMatB)

DistI<- vegdist(MatrixI,method="bray",binary=F)
DistMatI<-as.matrix(DistI)
PDatI<-melt(DistMatI)

DistL<- vegdist(MatrixL,method="bray",binary=F)
DistMatL<-as.matrix(DistL)
PDatL<-melt(DistMatL)
```

### Non-Metric Multidimensional Scaling
Using Non-matric Dimensional Scaling(NMDS) to visualize the cluster of samplings with plant age in four different plant species. We can find out whether the plant growth age has a stronger effect on bacterial communities.

```{r warning=FALSE}
#Non-Metric Multidimensional Scaling for Ammophila species.
set.seed(12138)
NMDSdatA<-metaMDS(DistA,k=2  ,trymax = 200)

PDatA<-data.frame(NMDS1=NMDSdatA$points[,1],
                 NMDS2=NMDSdatA$points[,2],
                 X=row.names(MatrixA))
PDatA<-merge(PDatA,SBData,by="X",all.x=T,all.y=F)
NMDSA<-qplot(x=NMDS1,y=NMDS2,colour=Age,alpha=I(0.6),data=PDatA) + theme_bw() + ggtitle("Ammophila")
```

```{r warning=FALSE}
#Non-Metric Multidimensional Scaling for Baccharis species.
set.seed(12138)
NMDSdatB<-metaMDS(DistB,k=2  ,trymax = 200)

PDatB<-data.frame(NMDS1=NMDSdatB$points[,1],
                 NMDS2=NMDSdatB$points[,2],
                 X=row.names(MatrixB))
PDatB<-merge(PDatB,SBData,by="X",all.x=T,all.y=F)
NMDSB<-qplot(x=NMDS1,y=NMDS2,colour=Age,alpha=I(0.6),data=PDatB)+theme_bw()+ ggtitle("Baccharis")
```
```{r warning=FALSE}
#Non-Metric Multidimensional Scaling for Iceplant species.
set.seed(12138)
NMDSdatI<-metaMDS(DistI,k=2  ,trymax = 200)

PDatI<-data.frame(NMDS1=NMDSdatI$points[,1],
                 NMDS2=NMDSdatI$points[,2],
                 X=row.names(MatrixI))
PDatI<-merge(PDatI,SBData,by="X",all.x=T,all.y=F)
NMDSI<-qplot(x=NMDS1,y=NMDS2,colour=Age,alpha=I(0.6),data=PDatI)+theme_bw() + ggtitle("Iceplant")
```
```{r}
#Non-Metric Multidimensional Scaling for Lupine species.
set.seed(12138)
NMDSdatL<-metaMDS(DistL,k=2  ,trymax = 200)

PDatL<-data.frame(NMDS1=NMDSdatL$points[,1],
                 NMDS2=NMDSdatL$points[,2],
                 X=row.names(MatrixL))
PDatL<-merge(PDatL,SBData,by="X",all.x=T,all.y=F)
NMDSL<-qplot(x=NMDS1,y=NMDS2,colour=Age,alpha=I(0.6),data=PDatL)+
  theme_bw()+
  ggtitle("Lupine")
```

```{r}
#Plotting  the NMDS result
plot_grid(NMDSA, NMDSB, NMDSI,NMDSL, ncol = 2)
```

Figure 2. The NMDS ordination plot shows the microbial community composition as factor of plant species and the age of plant individuals. Bacterial communities associated with the specific species are color-coded by individual plant age; the light to dark colour of point represent the age gradient from old to young, with species-specific minimum and maximum age.

According to figure 2, in each plant, the bacterial composition changes with the age of the plant. Among Ammophila species, the largest changes in bacterial community composition were observed. Bacterial abundance also changes with increasing plant age in the other three speceies. However, it can be found that bacterial abundance does not increase further after a few years after plant establishment.









